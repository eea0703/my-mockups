<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Россельхозбанк - Конструктор процессов</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #0a5f23;
            --primary-light: #e8f5e9;
            --secondary-color: #f5f5f5;
            --accent-color: #ff9800;
            --text-color: #333;
            --light-gray: #e9e9e9;
            --dark-gray: #757575;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --info-color: #2196f3;
            --publish-color: #1976d2;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #fafafa;
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        /* Header */
        .header {
            background-color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo h1 {
            font-size: 22px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        /* Кнопка "К процессам" */
        .btn-back {
            background-color: var(--accent-color);
            color: white;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: none;
        }
        
        .btn-back:hover {
            background-color: #e68a00;
        }
        
        /* Toolbar */
        .toolbar {
            width: 70px;
            background-color: var(--primary-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            z-index: 5;
        }
        
        .tool-group {
            width: 100%;
            margin-bottom: 25px;
        }
        
        .tool-group-title {
            color: rgba(255, 255, 255, 0.7);
            font-size: 11px;
            text-align: center;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 10px;
        }
        
        .tool-icon {
            width: 45px;
            height: 45px;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: white;
            font-size: 18px;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .tool-icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        
        .tool-icon.active {
            background-color: var(--accent-color);
            color: var(--text-color);
        }
        
        /* Основная область */
        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .canvas-container {
            flex: 1;
            background-color: var(--secondary-color);
            overflow: auto;
            position: relative;
            padding: 20px;
            display: flex;
        }
        
        .responsibility-zone {
            flex: 1;
            height: 100%;
            position: relative;
            border-right: 1px dashed var(--light-gray);
            padding: 10px;
        }
        
        .responsibility-zone:last-child {
            border-right: none;
        }
        
        .zone-header {
            text-align: center;
            padding: 8px;
            margin-bottom: 15px;
            background-color: rgba(255,255,255,0.8);
            border-radius: 6px;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 2;
        }
        
        .zone-customer .zone-header {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .zone-hr .zone-header {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .zone-staff .zone-header {
            background-color: #f3e5f5;
            color: #7b1fa2;
        }
        
        .canvas {
            width: 100%;
            height: calc(100% - 40px);
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.08);
            position: relative;
            background-image: 
                linear-gradient(#f5f5f5 1px, transparent 1px),
                linear-gradient(90deg, #f5f5f5 1px, transparent 1px);
            background-size: 20px 20px;
            min-height: 2000px;
        }
        
        /* Элементы процесса */
        .process-node {
            position: absolute;
            width: 180px;
            min-height: 60px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            cursor: move;
            display: flex;
            flex-direction: column;
            transition: all 0.2s;
            z-index: 2;
            overflow: hidden;
        }
        
        .process-node:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .node-header {
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .node-icon {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .node-title {
            font-size: 14px;
            font-weight: 500;
            flex: 1;
        }
        
        .node-content {
            padding: 12px;
            font-size: 13px;
            color: var(--dark-gray);
            background-color: #fcfcfc;
        }
        
        /* Стили для разных типов узлов */
        .trigger-node .node-header { background-color: #e3f2fd; }
        .trigger-node .node-icon { background-color: #2196f3; color: white; }
        
        .action-node .node-header { background-color: #e8f5e9; }
        .action-node .node-icon { background-color: #4caf50; color: white; }
        
        .decision-node .node-header { background-color: #fff3e0; }
        .decision-node .node-icon { background-color: #ff9800; color: white; }
        
        .output-node .node-header { background-color: #fce4ec; }
        .output-node .node-icon { background-color: #e91e63; color: white; }
        
        .connector {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #2196f3;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .connector:hover {
            transform: scale(1.2);
        }
        
        .connector.minus {
            background-color: #f44336;
        }
        
        /* Стили стрелок */
        .arrow {
            position: absolute;
            z-index: 1;
            pointer-events: none;
        }
        
        .arrow-line {
            stroke: #2196f3;
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrowhead);
            pointer-events: stroke;
        }  
        #arrowhead polygon {
            fill: #2196f3;
        }
#arrows-svg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 10;
}
        /* Панель свойств */
        .properties-panel {
            width: 320px;
            background-color: white;
            border-left: 1px solid var(--light-gray);
            padding: 20px;
            overflow-y: auto;
            box-shadow: -2px 0 10px rgba(0,0,0,0.05);
        }
        
        .properties-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .properties-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .property-group {
            margin-bottom: 25px;
        }
        
        .property-group h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .property-item {
            margin-bottom: 15px;
        }
        
        .property-item label {
            display: block;
            font-size: 13px;
            margin-bottom: 6px;
            color: var(--dark-gray);
            font-weight: 500;
        }
        
        .property-item input, 
        .property-item select,
        .property-item textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .property-item input:focus, 
        .property-item select:focus,
        .property-item textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(10, 95, 35, 0.1);
        }
        
        .property-item textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Кнопки */
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #08461b;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--light-gray);
            color: var(--text-color);
        }
        
        .btn-outline:hover {
            background-color: var(--light-gray);
        }
        
        .btn-accent {
            background-color: var(--accent-color);
            color: var(--text-color);
        }
        
        .btn-accent:hover {
            background-color: #e6b800;
        }
        
        .btn-edit {
            background-color: #f5f5f5;
            color: var(--text-color);
            border: 1px solid var(--light-gray);
        }
        
        .btn-edit:hover {
            background-color: #e0e0e0;
        }
        
        .btn-publish {
            background-color: var(--publish-color);
            color: white;
        }
        
        .btn-publish:hover {
            background-color: #1565c0;
        }
        
        /* Статус процесса */
        .process-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            background-color: #e8f5e9;
            color: var(--success-color);
        }
        
        /* Футер */
        .footer {
            padding: 12px 20px;
            background-color: white;
            border-top: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .zoom-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            background-color: #f5f5f5;
            border: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .zoom-btn:hover {
            background-color: #e9e9e9;
        }
        
        .process-node.dragging {
            box-shadow: 0 0 0 3px var(--accent-color), 0 5px 20px rgba(0,0,0,0.3);
            opacity: 0.9;
            z-index: 100;
        }
        .connector.highlight {
    background-color: #4caf50;
    transform: scale(1.2);
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Левая панель инструментов -->
        <div class="toolbar">
            <div class="tool-group">
                <div class="tool-group-title">ОСНОВНЫЕ</div>
                <div class="tool-icon active" title="Выбор">
                    <i class="fas fa-mouse-pointer"></i>
                </div>
                <div class="tool-icon" title="Рука">
                    <i class="fas fa-hand-paper"></i>
                </div>
            </div>
            
            <div class="tool-group">
                <div class="tool-group-title">ТРИГГЕРЫ</div>
                <div class="tool-icon" title="Запуск">
                    <i class="fas fa-play"></i>
                </div>
                <div class="tool-icon" title="Расписание">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="tool-icon" title="Вебхук">
                    <i class="fas fa-link"></i>
                </div>
            </div>
            
            <div class="tool-group">
                <div class="tool-group-title">ДЕЙСТВИЯ</div>
                <div class="tool-icon" title="HTTP запрос">
                    <i class="fas fa-globe"></i>
                </div>
                <div class="tool-icon" title="Почта">
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="tool-icon" title="База данных">
                    <i class="fas fa-database"></i>
                </div>
                <div class="tool-icon" title="Файлы">
                    <i class="fas fa-file"></i>
                </div>
            </div>
            
            <div class="tool-group">
                <div class="tool-group-title">ЛОГИКА</div>
                <div class="tool-icon" title="Условие">
                    <i class="fas fa-code-branch"></i>
                </div>
                <div class="tool-icon" title="Переключатель">
                    <i class="fas fa-random"></i>
                </div>
                <div class="tool-icon" title="Слияние">
                    <i class="fas fa-code-merge"></i>
                </div>
            </div>
            
            <div class="tool-group">
                <div class="tool-group-title">ПЛАТФОРМЫ</div>
                <div class="tool-icon" title="1C">
                    <i class="fas fa-calculator"></i>
                </div>
                <div class="tool-icon" title="ERP">
                    <i class="fas fa-cubes"></i>
                </div>
                <div class="tool-icon" title="HR система">
                    <i class="fas fa-users"></i>
                </div>
            </div>
        </div>
        
        <!-- Основная область -->
        <div class="main-area">
            <div class="header">
                <div class="logo">
                    <button class="btn-back" onclick="window.location.href='processes.html'">
                        <i class="fas fa-arrow-left"></i> К процессам
                    </button>
                    <h1>Конструктор бизнес-процессов</h1>
                    <div class="process-status">
                        <i class="fas fa-pen"></i> Редактирование
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-edit">
                        <i class="fas fa-save"></i> Сохранить
                    </button>
                    <button class="btn btn-publish">
                        <i class="fas fa-paper-plane"></i> Опубликовать
                    </button>
                </div>
            </div>
            
            <div class="canvas-container" id="canvasContainer">
                 <!-- SVG для стрелок (должен быть ПЕРВЫМ внутри canvas-container) -->
    <svg id="arrows-svg" style="position: absolute; width: 100%; height: 100%; pointer-events: none;">
    <defs>
        <marker 
            id="arrowhead" 
            markerWidth="10" 
            markerHeight="7" 
            refX="9" 
            refY="3.5" 
            orient="auto"
        >
            <polygon points="0 0, 10 3.5, 0 7" fill="#2196f3"/>
        </marker>
    </defs>
</svg>          
                <!-- Зона ответственности Заказчика -->
                <div class="responsibility-zone zone-customer">
                    <div class="zone-header">
                        <i class="fas fa-user-tie"></i> Заказчик
                    </div>
                    <div class="canvas" id="customerCanvas">
                        <!-- Узлы процесса для Заказчика -->
                        <div class="process-node trigger-node" style="top: 50px; left: 50px;">
                            <div class="node-header">
                                <div class="node-icon">
                                    <i class="fas fa-play"></i>
                                </div>
                                <div class="node-title">Заявка на подбор</div>
                            </div>
                            <div class="node-content">
                                Формирование заявки на подбор кандидата
                            </div>
                            <div class="connector" style="bottom: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                        
                        <div class="process-node decision-node" style="top: 300px; left: 50px;">
                            <div class="node-header">
                                <div class="node-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="node-title">Утверждение кандидата</div>
                            </div>
                            <div class="node-content">
                                Согласование кандидатуры с руководителем
                            </div>
                            <div class="connector" style="top: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="connector" style="bottom: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Зона ответственности HR -->
                <div class="responsibility-zone zone-hr">
                    <div class="zone-header">
                        <i class="fas fa-users"></i> HR-служба
                    </div>
                    <div class="canvas" id="hrCanvas">
                        <!-- Узлы процесса для HR -->
                        <div class="process-node action-node" style="top: 50px; left: 50px;">
                            <div class="node-header">
                                <div class="node-icon">
                                    <i class="fas fa-bullhorn"></i>
                                </div>
                                <div class="node-title">Публикация вакансии</div>
                            </div>
                            <div class="node-content">
                                Размещение вакансии на порталах: hh.ru, SuperJob
                            </div>
                            <div class="connector" style="top: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="connector" style="bottom: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                        
                        <div class="process-node action-node" style="top: 200px; left: 50px;">
                            <div class="node-header">
                                <div class="node-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="node-title">Сбор резюме</div>
                            </div>
                            <div class="node-content">
                                Автоматический сбор резюме с платформ
                            </div>
                            <div class="connector" style="top: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="connector" style="bottom: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                        
                        <div class="process-node decision-node" style="top: 350px; left: 50px;">
                            <div class="node-header">
                                <div class="node-icon">
                                    <i class="fas fa-filter"></i>
                                </div>
                                <div class="node-title">Первичный отбор</div>
                            </div>
                            <div class="node-content">
                                Автоматическая фильтрация по критериям
                            </div>
                            <div class="connector" style="top: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="connector" style="bottom: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Зона ответственности Кадровой службы -->
                <div class="responsibility-zone zone-staff">
                    <div class="zone-header">
                        <i class="fas fa-id-card"></i> Кадровая служба
                    </div>
                    <div class="canvas" id="staffCanvas">
                        <!-- Узлы процесса для Кадровой службы -->
                        <div class="process-node action-node" style="top: 50px; left: 50px;">
                            <div class="node-header">
                                <div class="node-icon">
                                    <i class="fas fa-user-clock"></i>
                                </div>
                                <div class="node-title">Назначение собеседования</div>
                            </div>
                            <div class="node-content">
                                Отправка приглашения кандидату
                            </div>
                            <div class="connector" style="top: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="connector" style="bottom: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                        
                        <div class="process-node action-node" style="top: 200px; left: 50px;">
                            <div class="node-header">
                                <div class="node-icon">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <div class="node-title">Техническое интервью</div>
                            </div>
                            <div class="node-content">
                                Проведение собеседования с HR и техническим специалистом
                            </div>
                            <div class="connector" style="top: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="connector" style="bottom: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                        
                        <div class="process-node output-node" style="top: 350px; left: 50px;">
                            <div class="node-header">
                                <div class="node-icon">
                                    <i class="fas fa-flag-checkered"></i>
                                </div>
                                <div class="node-title">Оформление оффера</div>
                            </div>
                            <div class="node-content">
                                Подготовка и отправка job offer
                            </div>
                            <div class="connector" style="top: -10px; left: 50%; margin-left: -10px;">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <div class="zoom-controls">
                    <div class="zoom-btn">
                        <i class="fas fa-minus"></i>
                    </div>
                    <span>100%</span>
                    <div class="zoom-btn">
                        <i class="fas fa-plus"></i>
                    </div>
                </div>
                <div>
                    <span style="color: var(--dark-gray); font-size: 13px;">Процесс: Подбор кандидата на вакантную должность</span>
                </div>
            </div>
        </div>
        
        <!-- Правая панель свойств -->
        <div class="properties-panel">
            <div class="properties-header">
                <div class="properties-title">Свойства узла</div>
                <button class="btn btn-outline">
                    <i class="fas fa-copy"></i> Дублировать
                </button>
            </div>
            
            <div class="property-group">
                <h3><i class="fas fa-info-circle"></i> Основная информация</h3>
                <div class="property-item">
                    <label>Название узла</label>
                    <input type="text" value="Техническое интервью">
                </div>
                <div class="property-item">
                    <label>Описание</label>
                    <textarea>Проведение собеседования с HR и техническим специалистом. Оценка профессиональных навыков и культурного соответствия.</textarea>
                </div>
                <div class="property-item">
                    <label>Ответственный отдел</label>
                    <select>
                        <option>Заказчик</option>
                        <option selected>HR-служба</option>
                        <option>Кадровая служба</option>
                    </select>
                </div>
            </div>
            
            <div class="property-group">
                <h3><i class="fas fa-cog"></i> Параметры выполнения</h3>
                <div class="property-item">
                    <label>Ответственный</label>
                    <select>
                        <option>HR-менеджер</option>
                        <option>Руководитель отдела</option>
                        <option>Технический специалист</option>
                        <option selected>Команда HR + Тех.специалист</option>
                    </select>
                </div>
                <div class="property-item">
                    <label>Срок выполнения</label>
                    <input type="text" value="3 рабочих дня">
                </div>
                <div class="property-item">
                    <label>Приоритет</label>
                    <select>
                        <option>Низкий</option>
                        <option>Средний</option>
                        <option selected>Высокий</option>
                        <option>Критичный</option>
                    </select>
                </div>
            </div>
            
            <div class="property-group">
                <h3><i class="fas fa-tasks"></i> Критерии оценки</h3>
                <div class="property-item">
                    <label>Шкала оценки</label>
                    <select>
                        <option selected>5-балльная система</option>
                        <option>10-балльная система</option>
                        <option>Да/Нет</option>
                        <option>Соответствует/Не соответствует</option>
                    </select>
                </div>
                <div class="property-item">
                    <label>Минимальный проходной балл</label>
                    <input type="number" value="4">
                </div>
                <div class="property-item">
                    <label>Обязательные компетенции</label>
                    <textarea>Java, Spring Framework, SQL, ООП, Английский B1+</textarea>
                </div>
            </div>
            
            <div class="property-group">
                <button class="btn btn-accent" style="width: 100%;">
                    <i class="fas fa-play-circle"></i> Тестовый запуск узла
                </button>
                <button class="btn btn-outline" style="width: 100%; margin-top: 10px;">
                    <i class="fas fa-trash-alt"></i> Удалить узел
                </button>
            </div>
        </div>
    </div>

    <script>
        let isCreatingArrow = false;
let startConnector = null;
let startNode = null;
        document.addEventListener('DOMContentLoaded', function() {
            const svg = document.getElementById('arrows-svg');
            const canvasContainer = document.getElementById('canvasContainer');
            let arrows = [];
            let isCreatingArrow = false;
            let currentArrow = null;
            let startConnector = null;
            
            // Обработчики для узлов процесса
            document.querySelectorAll('.process-node').forEach(node => {
                node.addEventListener('mousedown', startDrag);
                node.addEventListener('click', selectElement);
            });
            
            // Обработчики для коннекторов (кнопки +/-)
            document.querySelectorAll('.connector').forEach(connector => {
                connector.addEventListener('mousedown', handleConnectorClick);
            });
            
            // Обработчик для перемещения стрелок
            svg.addEventListener('mousedown', function(e) {
                if (e.target.classList.contains('arrow-line')) {
                    const arrowId = e.target.closest('.arrow').id;
                    const arrow = arrows.find(a => a.id === arrowId);
                    if (arrow) {
                        startArrowDrag(arrow, e);
                    }
                }
            });
            
            // Функция обработки клика на коннектор (+/-)
           function handleConnectorClick(e) {
    e.stopPropagation();
    const connector = e.currentTarget;
    const node = connector.closest('.process-node');

    if (connector.innerHTML.includes('plus')) {
        // Режим выбора начала или конца стрелки
        if (!isCreatingArrow) {
            // Начало — выделяем коннектор
            isCreatingArrow = true;
            startConnector = connector;
            startNode = node;

            connector.classList.add('highlight');
            document.body.style.cursor = 'crosshair';
        } else {
            // Конец — создаём стрелку
            if (startConnector !== connector) {
                const endNode = node;
                const arrow = createRightAngleArrow(startNode, startConnector, endNode, connector);
                arrows.push(arrow);

                // Меняем значки
                startConnector.innerHTML = '<i class="fas fa-minus"></i>';
                startConnector.classList.add('minus');
                startConnector.classList.remove('highlight');
                startConnector.setAttribute('data-arrow-id', arrow.id);

                connector.innerHTML = '<i class="fas fa-minus"></i>';
                connector.classList.add('minus');
                connector.setAttribute('data-arrow-id', arrow.id);
            }

            // Сброс
            isCreatingArrow = false;
            startConnector = null;
            startNode = null;
            document.body.style.cursor = '';
        }
    } else {
        // Удаление стрелки по клику на минус
        const arrowId = connector.getAttribute('data-arrow-id');
        if (arrowId) {
            removeArrow(arrowId);
            connector.innerHTML = '<i class="fas fa-plus"></i>';
            connector.classList.remove('minus');
        }
    }
}
            function createRightAngleArrow(startNode, startConnector, endNode, endConnector) {
    const arrowId = 'arrow-' + Date.now();

    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    path.id = 'path-' + arrowId;
    path.classList.add('arrow-line');
    path.setAttribute('marker-end', 'url(#arrowhead)');

    const arrowGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
    arrowGroup.id = arrowId;
    arrowGroup.classList.add('arrow');
    arrowGroup.appendChild(path);
    svg.appendChild(arrowGroup);

    // Создаём объект стрелки
    const arrow = {
        id: arrowId,
        element: arrowGroup,
        path: path,
        startNode: startNode,
        startConnector: startConnector,
        endNode: endNode,
        endConnector: endConnector,
        start: { x: 0, y: 0 },
        end: { x: 0, y: 0 }
    };

    // Обновляем путь
    updateRightAngleArrowPath(arrow);
    return arrow;
}
function updateRightAngleArrowPath(arrow) {
    const startRect = arrow.startConnector.getBoundingClientRect();
    const endRect = arrow.endConnector.getBoundingClientRect();
    const canvasRect = canvasContainer.getBoundingClientRect();

    // Центр коннекторов
    const startX = startRect.left - canvasRect.left + startRect.width / 2;
    const startY = startRect.top - canvasRect.top + startRect.height / 2;
    const endX = endRect.left - canvasRect.left + endRect.width / 2;
    const endY = endRect.top - canvasRect.top + endRect.height / 2;

    // Сохраняем координаты
    arrow.start = { x: startX, y: startY };
    arrow.end = { x: endX, y: endY };

    // Определяем направление
    const dx = endX - startX;
    const dy = endY - startY;

    let d;

    // Горизонтально-вертикально или вертикально-горизонтально?
    if (Math.abs(dx) > Math.abs(dy)) {
        // В основном горизонтально
        const midX = startX + dx / 2;
        d = `M ${startX} ${startY} 
             H ${midX} 
             V ${endY} 
             H ${endX}`;
    } else {
        // В основном вертикально
        const midY = startY + dy / 2;
        d = `M ${startX} ${startY} 
             V ${midY} 
             H ${endX} 
             V ${endY}`;
    }

    arrow.path.setAttribute('d', d);
}
            // Функция создания временной стрелки
            // При создании стрелки
function createArrow(startX, startY, endX, endY) {
    const arrowId = 'arrow-' + Date.now();
    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    path.id = 'path-' + arrowId;
    path.classList.add('arrow-line');
    path.setAttribute('stroke', '#2196f3');
    path.setAttribute('stroke-width', '2');
    path.setAttribute('fill', 'none');
    path.setAttribute('marker-end', 'url(#arrowhead)');

    const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'g');
    arrow.id = arrowId;
    arrow.classList.add('arrow');
    arrow.appendChild(path);
    svg.appendChild(arrow);

    updateArrowPath({ id: arrowId, path: path }, startX, startY, endX, endY);

    return {
        id: arrowId,
        element: arrow,
        path: path,
        start: { x: startX, y: startY },
        end: { x: endX, y: endY },
        startNode: startConnector?.closest('.process-node'),
        startConnector: startConnector,
        endConnector: null
    };
}
            
            // Функция перемещения временной стрелки
function moveTempArrow(e) {
    if (!isCreatingArrow || !currentArrow) return;
    const endX = e.clientX - canvasContainer.getBoundingClientRect().left;
    const endY = e.clientY - canvasContainer.getBoundingClientRect().top;
    updateArrowPath(currentArrow, currentArrow.start.x, currentArrow.start.y, endX, endY);
    currentArrow.end = { x: endX, y: endY };
}
            
            // Функция завершения создания стрелки
            function finishArrow(e) {
                if (!isCreatingArrow || !currentArrow) return;
                
                // Находим ближайший коннектор
                const endConnector = findNearestConnector(e.clientX, e.clientY);
                
                if (endConnector && endConnector !== startConnector) {
                    // Фиксируем стрелку между двумя узлами
                    const endNode = endConnector.closest('.process-node');
                    const endRect = endNode.getBoundingClientRect();
                    
                    const endX = parseInt(endNode.style.left) + (endConnector.style.left === '50%' ? 
                        endRect.width / 2 : endConnector.offsetLeft);
                    const endY = parseInt(endNode.style.top) + (endConnector.style.bottom ? 
                        endRect.height : endConnector.offsetTop);
                    
                    // Обновляем путь стрелки с изгибом (как в PowerPoint)
                    updateArrowPath(currentArrow, currentArrow.start.x, currentArrow.start.y, endX, endY);
                    
                    // Сохраняем стрелку
                    currentArrow.endNode = endNode;
                    currentArrow.startConnector = startConnector;
                    currentArrow.endConnector = endConnector;
                    arrows.push(currentArrow);
                    
                    // Меняем значки коннекторов
                    startConnector.innerHTML = '<i class="fas fa-minus"></i>';
                    startConnector.classList.add('minus');
                    startConnector.setAttribute('data-arrow-id', currentArrow.id);
                    
                    endConnector.innerHTML = '<i class="fas fa-minus"></i>';
                    endConnector.classList.add('minus');
                    endConnector.setAttribute('data-arrow-id', currentArrow.id);
                } else {
                    // Удаляем временную стрелку, если не прикрепили к коннектору
                    svg.removeChild(currentArrow.element);
                }
                
                // Сбрасываем состояние
                isCreatingArrow = false;
                currentArrow = null;
                startConnector = null;
                document.body.style.cursor = '';
                
                // Удаляем обработчики
                canvasContainer.removeEventListener('mousemove', moveTempArrow);
                canvasContainer.removeEventListener('mouseup', finishArrow);
            }
            
            // Функция поиска ближайшего коннектора
            function findNearestConnector(x, y) {
                let minDistance = Infinity;
                let nearestConnector = null;
                
                document.querySelectorAll('.connector').forEach(connector => {
                    const rect = connector.getBoundingClientRect();
                    const cx = rect.left + rect.width / 2;
                    const cy = rect.top + rect.height / 2;
                    const distance = Math.sqrt(Math.pow(x - cx, 2) + Math.pow(y - cy, 2));
                    
                    if (distance < 30 && distance < minDistance) {
                        minDistance = distance;
                        nearestConnector = connector;
                    }
                });
                
                return nearestConnector;
            }
            
            // Функция обновления пути стрелки с изгибом
function updateArrowPath(arrow, startX, startY, endX, endY) {
    // Линия с изгибом (как в PowerPoint)
    const midX = startX + (endX - startX) * 0.5;
    const path = `M${startX},${startY} 
                 C${midX},${startY} 
                  ${midX},${endY} 
                  ${endX},${endY}`;
    
    arrow.path.setAttribute('d', path);
}
            
            // Функция удаления стрелки
            function removeArrow(arrowId) {
                const arrowIndex = arrows.findIndex(a => a.id === arrowId);
                if (arrowIndex !== -1) {
                    const arrow = arrows[arrowIndex];
                    svg.removeChild(arrow.element);
                    arrows.splice(arrowIndex, 1);
                }
            }
            
            // Функция начала перетаскивания стрелки
            function startArrowDrag(arrow, e) {
                const startX = e.clientX;
                const startY = e.clientY;
                
                function moveArrow(e) {
                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;
                    
                    // Обновляем позиции точек стрелки
                    const path = arrow.path.getAttribute('d').split(' ');
                    const newStartX = parseFloat(path[0].substring(1)) + dx;
                    const newStartY = parseFloat(path[1]) + dy;
                    const newEndX = parseFloat(path[path.length-2].substring(1)) + dx;
                    const newEndY = parseFloat(path[path.length-1]) + dy;
                    
                    updateArrowPath(arrow, newStartX, newStartY, newEndX, newEndY);
                }
                
                function stopArrowDrag() {
                    document.removeEventListener('mousemove', moveArrow);
                    document.removeEventListener('mouseup', stopArrowDrag);
                }
                
                document.addEventListener('mousemove', moveArrow);
                document.addEventListener('mouseup', stopArrowDrag);
            }
            
            // Функции для работы с узлами процесса
            function startDrag(e) {
                if (e.target.classList.contains('connector')) return;
                
                const node = e.currentTarget;
                const startX = e.clientX;
                const startY = e.clientY;
                const startLeft = parseInt(node.style.left);
                const startTop = parseInt(node.style.top);
                
                function moveNode(e) {
                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;
                    
                    node.style.left = (startLeft + dx) + 'px';
                    node.style.top = (startTop + dy) + 'px';
                    
                    // Обновляем связанные стрелки
                    updateConnectedArrows(node);
                }
                
                function stopDrag() {
                    document.removeEventListener('mousemove', moveNode);
                    document.removeEventListener('mouseup', stopDrag);
                }
                
                document.addEventListener('mousemove', moveNode);
                document.addEventListener('mouseup', stopDrag);
                e.stopPropagation();
            }
            
            function selectElement(e) {
                if (e.target.classList.contains('connector')) return;
                
                document.querySelectorAll('.process-node').forEach(n => {
                    n.style.boxShadow = '0 3px 10px rgba(0,0,0,0.1)';
                });
                e.currentTarget.style.boxShadow = '0 0 0 3px #0a5f23, 0 5px 15px rgba(0,0,0,0.2)';
                e.stopPropagation();
            }
            
            // Функция обновления связанных стрелок при перемещении узла
function updateConnectedArrows(node) {
    // Проходим по всем стрелкам
    arrows.forEach(arrow => {
        // Проверяем, связан ли узел с этой стрелкой (как начало или конец)
        if (arrow.startNode === node || arrow.endNode === node) {
            const canvasRect = canvasContainer.getBoundingClientRect();
            let needsUpdate = false;

            // === Обновляем начало стрелки, если узел — стартовый ===
            if (arrow.startNode === node && arrow.startConnector) {
                const connRect = arrow.startConnector.getBoundingClientRect();
                arrow.start = {
                    x: connRect.left - canvasRect.left + connRect.width / 2,
                    y: connRect.top - canvasRect.top + connRect.height / 2
                };
                needsUpdate = true;
            }

            // === Обновляем конец стрелки, если узел — конечный ===
            if (arrow.endNode === node && arrow.endConnector) {
                const connRect = arrow.endConnector.getBoundingClientRect();
                arrow.end = {
                    x: connRect.left - canvasRect.left + connRect.width / 2,
                    y: connRect.top - canvasRect.top + connRect.height / 2
                };
                needsUpdate = true;
            }

            // Только если что-то изменилось — перерисовываем стрелку
            if (needsUpdate) {
                updateArrowPath(arrow, arrow.start.x, arrow.start.y, arrow.end.x, arrow.end.y);
            }
        }
    });
}
            
            // Имитация клика по кнопке сохранения
            document.querySelector('.btn-edit').addEventListener('click', function() {
                alert('Черновик процесса "Подбор кандидата" успешно сохранен!');
            });
            
            // Имитация клика по кнопке публикации
            document.querySelector('.btn-publish').addEventListener('click', function() {
                alert('Процесс "Подбор кандидата" успешно опубликован!');
                window.location.href = 'processes.html';
            });
        });
    </script>
</body>
</html>