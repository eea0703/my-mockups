<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Россельхозбанк - Управление задачами</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-color: #0a5f38;
      --primary-light: #e8f5e9;
      --secondary-color: #f8f8f8;
      --success-color: #4caf50;
      --warning-color: #ff9800;
      --danger-color: #f44336;
      --info-color: #2196f3;
      --text-color: #333;
      --text-light: #666;
      --light-gray: #e0e0e0;
      --dark-gray: #757575;
      --bg-color: #f5f5f5;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Roboto', sans-serif;
      color: var(--text-color);
      background-color: var(--bg-color);
      line-height: 1.5;
    }
    .container {
      display: grid;
      grid-template-columns: 250px 1fr;
      min-height: 100vh;
    }
    .sidebar {
      background-color: var(--primary-color);
      color: white;
      padding: 20px 0;
    }
    .logo {
      text-align: center;
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .nav-menu {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .nav-item {
      padding: 12px 20px;
      cursor: pointer;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      font-size: 15px;
    }
    .nav-item:hover, .nav-item.active {
      background-color: rgba(255, 255, 255, 0.1);
    }
    .nav-item i {
      margin-right: 12px;
      width: 20px;
      text-align: center;
      font-size: 16px;
    }
    .nav-item a {
      color: inherit;
      text-decoration: none;
      display: flex;
      align-items: center;
      width: 100%;
      height: 100%;
    }
    .main-content {
      padding: 20px;
      background-color: var(--bg-color);
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--light-gray);
    }
    .user-info {
      display: flex;
      align-items: center;
    }
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--primary-color);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      font-weight: bold;
    }
    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
      position: relative;
    }
    .card-title {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 15px;
      color: var(--primary-color);
      display: flex;
      align-items: center;
    }
    .card-title i {
      margin-right: 10px;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .select-control {
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid var(--light-gray);
      background-color: white;
      font-size: 14px;
      min-width: 200px;
    }
    .btn {
      padding: 8px 16px;
      border-radius: 4px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }
    .btn-primary:hover {
      background-color: #0b4b2c;
    }
    .btn-orange {
      background-color: #ff9800;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: background-color 0.3s;
    }
    .btn-orange:hover {
      background-color: #e68900;
    }
    .btn-outline {
      background-color: white;
      border: 1px solid var(--light-gray);
      color: var(--text-color);
    }
    .btn-outline:hover {
      background-color: #f5f5f5;
    }
    .btn-icon {
      width: 32px;
      height: 32px;
      padding: 0;
      border-radius: 50%;
    }
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }
    .workload-indicator {
      height: 10px;
      border-radius: 5px;
      background-color: var(--light-gray);
      margin-top: 5px;
      overflow: hidden;
    }
    .workload-progress {
      height: 100%;
    }
    .workload-optimal {
      background-color: var(--success-color);
    }
    .workload-medium {
      background-color: var(--warning-color);
    }
    .workload-high {
      background-color: #FFA500;
    }
    .workload-critical {
      background-color: var(--danger-color);
    }
    .badge {
      display: inline-block;
      padding: 3px 6px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 500;
      background-color: var(--primary-light);
      color: var(--primary-color);
    }
    .kanban-board {
      display: flex;
      gap: 15px;
      overflow-x: auto;
      padding-bottom: 10px;
    }
    .kanban-column {
      min-width: 280px;
      background-color: #f5f5f5;
      border-radius: 8px;
      padding: 15px;
      flex: 1;
    }
    .kanban-title {
      font-weight: 500;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .kanban-items {
      min-height: 100px;
    }
    .kanban-item {
      background-color: white;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 10px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      cursor: move;
      transition: all 0.2s;
      position: relative;
    }
    .kanban-item:hover {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transform: translateY(-1px);
    }
    .task-priority {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 5px;
    }
    .priority-high {
      background-color: var(--danger-color);
    }
    .priority-medium {
      background-color: var(--warning-color);
    }
    .priority-low {
      background-color: var(--success-color);
    }
    .task-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin: 8px 0;
    }
    .task-tag {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 10px;
      background-color: #e0e0e0;
      color: #424242;
    }
    .task-footer {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 12px;
      color: var(--text-light);
      align-items: center;
    }
    .task-actions {
      display: flex;
      gap: 8px;
    }
    .task-btn {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: transparent;
      border: none;
      cursor: pointer;
      color: var(--dark-gray);
      transition: all 0.2s;
    }
    .task-btn:hover {
      background-color: #f5f5f5;
      color: var(--text-color);
    }
    .chart-container {
      height: 300px;
      margin-top: 15px;
      position: relative;
    }
    .chart-summary {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid var(--light-gray);
    }
    .summary-item {
      background-color: #f9f9f9;
      padding: 12px;
      border-radius: 6px;
    }
    .summary-label {
      display: block;
      font-size: 13px;
      color: var(--text-light);
      margin-bottom: 5px;
    }
    .summary-value {
      font-weight: 500;
      color: var(--primary-color);
      font-size: 16px;
    }
    .quick-create {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .task-form {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .form-group {
      flex: 1;
      min-width: 200px;
    }
    .form-label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
      color: var(--text-light);
    }
    .form-control {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    .form-control:focus {
      outline: none;
      border-color: var(--primary-color);
    }
    .filters {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }
    .filter-btn {
      background: white;
      border: 1px solid #ddd;
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 13px;
      transition: all 0.2s;
    }
    .filter-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }
    .filter-btn.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    .search-box {
      flex: 1;
      max-width: 300px;
      padding: 8px 15px;
      border: 1px solid #ddd;
      border-radius: 20px;
      font-size: 14px;
    }
    .tasks-section {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    .task-card {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.2s;
    }
    .task-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .task-department {
      font-weight: 500;
      color: var(--primary-color);
      margin-bottom: 5px;
    }
    .task-type {
      color: var(--text-light);
      font-size: 14px;
    }
    .task-deadline {
      margin-top: 10px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 5px;
      color: var(--text-light);
    }
    .task-status {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 12px;
      margin-top: 10px;
    }
    .status-in-progress {
      background: #e3f2fd;
      color: #1976d2;
    }
    .status-review {
      background: #fff8e1;
      color: #ffa000;
    }
    .status-estimation {
      background: #f3e5f5;
      color: #8e24aa;
    }
    .templates-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .template-card {
      background: white;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid #eee;
    }
    .template-card:hover {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    .template-icon {
      font-size: 24px;
      margin-bottom: 10px;
    }
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .metric-card {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .metric-value {
      font-size: 24px;
      font-weight: 500;
      margin: 10px 0;
      color: var(--primary-color);
    }
    .metric-title {
      color: var(--text-light);
      font-size: 14px;
    }
    .recommendation {
      margin-top: 20px;
      padding: 15px;
      background: #fff8e1;
      border-left: 4px solid var(--warning-color);
      border-radius: 4px;
      font-size: 14px;
    }
    .dropdown {
      position: relative;
      display: inline-block;
    }
    .dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      background-color: white;
      min-width: 200px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      z-index: 1;
      border-radius: 6px;
      padding: 8px 0;
    }
    .dropdown:hover .dropdown-content {
      display: block;
    }
    .dropdown-item {
      padding: 8px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-color);
      text-decoration: none;
      font-size: 14px;
    }
    .dropdown-item:hover {
      background-color: #f5f5f5;
      color: var(--primary-color);
    }
    .dropdown-divider {
      height: 1px;
      background-color: #eee;
      margin: 8px 0;
    }
    @media (max-width: 1200px) {
      .dashboard-grid {
        grid-template-columns: 1fr 1fr;
      }
      .chart-summary {
        grid-template-columns: 1fr 1fr;
      }
    }
    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }
      .sidebar {
        display: none;
      }
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      .chart-summary {
        grid-template-columns: 1fr;
      }
      .task-form {
        flex-direction: column;
      }
      .form-group {
        width: 100%;
      }
    }
  </style>
</head>
<body>
    <div class="container">
    <!-- Сайдбар -->
    <div class="sidebar">
      <div class="logo">
        <h3>Россельхозбанк</h3>
        <p>Управление процессами</p>
      </div>
      <div class="nav-menu">
        <div class="nav-item"><a href="index.html"><i class="fa fa-list"></i> Задачи</a></div>
        <div class="nav-item"><a href="processes.html"><i class="fas fa-project-diagram"></i> Процессы</a></div>
        <div class="nav-item"><a href="projects.html"><i class="fas fa-briefcase"></i> Проекты</a></div>
        <div class="nav-item"><a href="#"><i class="fas fa-tasks"></i> Мои задачи</a></div>
        <div class="nav-item"><a href="#"><i class="fas fa-chart-bar"></i> Аналитика</a></div>
        <div class="nav-item"><a href="#"><i class="fas fa-cog"></i> Настройки</a></div>
        <div class="nav-item"><a href="planner.html"><i class="fas fa-calendar-alt"></i> Планировщик</a></div>
        <!-- Новый пункт: Матрица компетенций -->
        <div class="nav-item active">
          <a href="competency-matrix.html">
            <i class="fas fa-th"></i> Матрица компетенций
          </a>
        </div>
      </div>
    </div>

    <div class="main-content">
      <div class="header">
        <h2><i class="fas fa-tasks"></i> Управление задачами</h2>
        <div class="user-info">
          <div class="dropdown">
            <div class="user-avatar">ИИ</div>
            <div class="dropdown-content">
              <a href="#" class="dropdown-item"><i class="fas fa-user"></i> Профиль</a>
              <a href="#" class="dropdown-item"><i class="fas fa-cog"></i> Настройки</a>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item"><i class="fas fa-sign-out-alt"></i> Выйти</a>
            </div>
          </div>
          <span>Иванов Иван</span>
        </div>
      </div>

      <div class="quick-create">
        <h3><i class="fas fa-plus-circle"></i> Быстрое создание задачи</h3>
        <div class="task-form">
          <div class="form-group">
            <label class="form-label">Название задачи</label>
            <input type="text" class="form-control" placeholder="Введите название задачи...">
          </div>
          <div class="form-group">
            <label class="form-label">Тип задачи</label>
            <select class="form-control">
              <option>Запрос</option>
              <option>Согласование</option>
              <option>Инцидент</option>
              <option>Другое</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Приоритет</label>
            <select class="form-control">
              <option>Низкий</option>
              <option>Средний</option>
              <option>Высокий</option>
              <option>Критический</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Срок выполнения</label>
            <input type="date" class="form-control">
          </div>
        </div>
        <a href="create-intra-task.html">
          <button class="btn btn-primary" style="margin-right: 10px;">
            <i class="fas fa-plus"></i> Создать внутреннюю задачу
          </button>
        </a>
        <a href="create-extra-task.html">
          <button class="btn-orange">
            <i class="fas fa-handshake"></i> Взять в работу внешнюю задачу
            <span id="notification-badge" style="margin-left: 8px; background: #f44336; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px;">0</span>
          </button>
        </a>
        <div class="filters" style="margin-top: 20px;">
          <input type="text" class="search-box" placeholder="Поиск по задачам...">
          <button class="filter-btn active"><i class="fas fa-user"></i> Мои задачи</button>
          <button class="filter-btn"><i class="fas fa-building"></i> Подразделение</button>
          <button class="filter-btn"><i class="fas fa-exclamation"></i> Срочные</button>
          <button class="filter-btn"><i class="fas fa-clock"></i> Просроченные</button>
          <button class="filter-btn"><i class="fas fa-filter"></i> Доп. фильтры</button>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title"><i class="fas fa-chart-pie"></i> Текущая загрузка сотрудников</div>
          <select id="department-filter" class="select-control">
            <option value="all">Все подразделения</option>
            <option value="УОРиПМ">УОРиПМ</option>
            <option value="ЭО">ЭО</option>
            <option value="УПМ">УПМ</option>
            <option value="УПМ">УПМ</option>
          </select>
        </div>
        <div class="dashboard-grid" id="workload-container">
          <!-- Динамически заполняется через JS -->
        </div>
<div style="margin-top: 15px; text-align: right;">
  <a href="planner.html">
    <button class="btn btn-primary">
      <i class="fas fa-calendar-alt"></i> Перейти к календарному планированию
    </button>
  </a>
</div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title"><i class="fas fa-project-diagram"></i> Управление задачами (Канбан)</div>
          <div>
            <button class="btn btn-outline"><i class="fas fa-sliders-h"></i> Настроить вид</button>
            <button class="btn btn-primary"><i class="fas fa-plus"></i> Добавить задачу</button>
          </div>
        </div>
        <div class="kanban-board" id="kanban-board">
          <div class="kanban-column">
            <div class="kanban-title">На оценке <span class="badge">3</span></div>
            <div id="todo-column" class="kanban-items"></div>
          </div>
          <div class="kanban-column">
            <div class="kanban-title">В работе <span class="badge">2</span></div>
            <div id="in-progress-column" class="kanban-items"></div>
          </div>
          <div class="kanban-column">
            <div class="kanban-title">На паузе <span class="badge">1</span></div>
            <div id="paused-column" class="kanban-items"></div>
          </div>
          <div class="kanban-column">
            <div class="kanban-title">Завершено <span class="badge">1</span></div>
            <div id="completed-column" class="kanban-items"></div>
          </div>
        </div>
      </div>

      <!-- Блок "Операционная эффективность" — заменён на таблицу -->
      <div class="card">
        <div class="card-header">
          <div class="card-title"><i class="fas fa-chart-line"></i> Эффективность сотрудников</div>
          <select class="select-control" id="efficiency-period">
            <option>Последние 30 дней</option>
            <option>Последние 90 дней</option>
            <option>Текущий квартал</option>
          </select>
        </div>

        <!-- Таблица эффективности -->
        <div class="table-responsive">
          <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
            <thead>
              <tr style="background-color: #f5f5f5; border-bottom: 2px solid #ddd;">
                <th style="padding: 12px; text-align: left;">Сотрудник</th>
                <th style="padding: 12px; text-align: left;">Подразделение</th>
                <th style="padding: 12px; text-align: center;">% выполнения</th>
                <th style="padding: 12px; text-align: center;">Ср. время (дни)</th>
                <th style="padding: 12px; text-align: center;">Возвраты</th>
              </tr>
            </thead>
            <tbody id="efficiency-table-body">
              <!-- Заполняется через JS -->
            </tbody>
          </table>
        </div>

        <!-- Кнопка перехода на подробную страницу -->
        <div style="margin-top: 20px; text-align: right;">
          <a href="efficiency-rating.html">
            <button class="btn btn-primary">
              <i class="fas fa-external-link-alt"></i> Подробная аналитика
            </button>
          </a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Мок-данные для демонстрации
    const mockData = {
      employees: [
        { id: 1, name: 'Петров А.В.', department: 'УОРиПМ', workload: 65 },
        { id: 2, name: 'Сидорова Е.П.', department: 'УОРиПМ', workload: 82 },
        { id: 3, name: 'Иванов И.И.', department: 'УОРиПМ', workload: 78 },
        { id: 4, name: 'Кузнецова О.Л.', department: 'ЭО', workload: 45 },
        { id: 5, name: 'Смирнов Д.М.', department: 'ЭО', workload: 60 },
        { id: 6, name: 'Васильева А.К.', department: 'УПМ', workload: 92 },
        { id: 7, name: 'Николаев П.С.', department: 'УПМ', workload: 88 }
      ],
      processes: [
        { id: 1, name: 'Согласование ЦИЗ ДБД', status: 'active', progress: 65, priority: 'high', deadline: '20.08.2024' },
        { id: 2, name: 'Обновление реестра процессов', status: 'active', progress: 30, priority: 'medium', deadline: '25.08.2024' },
        { id: 3, name: 'Актуализаия ФРМ ДИТ РБ', status: 'paused', progress: 15, priority: 'low', deadline: '10.08.2024' },
        { id: 4, name: 'Обучение нового сотрудника', status: 'completed', progress: 100, priority: 'medium', deadline: '05.08.2024' }
      ],
      tasks: [
        { id: 1, name: 'Изменение штатного расписания ДИТ', processId: 1, status: 'todo', priority: 'high', assignee: 'Петров А.В.', deadline: '15.08.2024', tags: ['документы', 'проверка'] },
        { id: 2, name: 'Реорганизация ДР', processId: 1, status: 'todo', priority: 'high', assignee: 'Иванов И.И.', deadline: '16.08.2024', tags: ['согласование'] },
        { id: 3, name: 'Обновление КПЭ по процессам', processId: 2, status: 'todo', priority: 'medium', assignee: 'Сидорова Е.П.', deadline: '18.08.2024', tags: ['реестр'] },
        { id: 4, name: 'Внесение изменений в реестр процессов', processId: 1, status: 'in-progress', priority: 'medium', assignee: 'Кузнецова О.Л.', deadline: '12.08.2024', tags: ['отчет'] },
        { id: 5, name: 'Согласование протокола КСИКР', processId: 2, status: 'in-progress', priority: 'low', assignee: 'Смирнов Д.М.', deadline: '14.08.2024', tags: ['проверка'] },
        { id: 6, name: 'Согласование ЦИЗ ДБД', processId: 3, status: 'paused', priority: 'low', assignee: 'Васильева А.К.', deadline: '10.08.2024', tags: ['обучение'] },
        { id: 7, name: 'Актуализаия ФРМ ДИТ РБ', processId: 4, status: 'completed', priority: 'medium', assignee: 'Николаев П.С.', deadline: '05.08.2024', tags: ['документы'] },
        { id: 8, name: 'Согласование проектной мотивации', processId: 1, status: 'estimation', priority: 'high', assignee: 'Иванов И.И.', deadline: '12.08.2024', tags: ['оценка', 'интеграция'] }
      ]
    };

    // Фильтрация сотрудников по подразделению
    function filterEmployeesByDepartment(department) {
      if (department === 'all') {
        return mockData.employees;
      }
      return mockData.employees.filter(emp => emp.department === department);
    }

    // Рендер загрузки сотрудников
    function renderWorkload(employees) {
      const container = document.getElementById('workload-container');
      container.innerHTML = '';
      employees.forEach(employee => {
        let workloadClass = 'workload-optimal';
        if (employee.workload > 90) workloadClass = 'workload-critical';
        else if (employee.workload > 80) workloadClass = 'workload-high';
        else if (employee.workload > 60) workloadClass = 'workload-medium';
        const employeeCard = document.createElement('div');
        employeeCard.className = 'card';
        employeeCard.innerHTML = `
          <h4>${employee.name}</h4>
          <p>${employee.department}</p>
          <div class="workload-indicator">
            <div class="workload-progress ${workloadClass}" style="width: ${employee.workload}%"></div>
          </div>
          <small>Загруженность: ${employee.workload}%</small>
        `;
        container.appendChild(employeeCard);
      });
    }

    // Рендер задач на канбан-доске
    function renderKanbanTasks(tasks) {
      const todoColumn = document.getElementById('todo-column');
      const inProgressColumn = document.getElementById('in-progress-column');
      const pausedColumn = document.getElementById('paused-column');
      const completedColumn = document.getElementById('completed-column');
      todoColumn.innerHTML = '';
      inProgressColumn.innerHTML = '';
      pausedColumn.innerHTML = '';
      completedColumn.innerHTML = '';
      tasks.forEach(task => {
        let priorityClass = 'priority-low';
        if (task.priority === 'high') priorityClass = 'priority-high';
        else if (task.priority === 'medium') priorityClass = 'priority-medium';
        const tagsHTML = task.tags.map(tag => `<span class="task-tag">${tag}</span>`).join('');
        const taskElement = document.createElement('div');
        taskElement.className = 'kanban-item';
        taskElement.setAttribute('data-task-id', task.id);
        taskElement.setAttribute('draggable', 'true');
        taskElement.innerHTML = `
          <div>
            <span class="task-priority ${priorityClass}"></span>
            <strong>${task.name}</strong>
          </div>
          <p style="margin-top: 5px; font-size: 13px; color: var(--text-light);">Процесс #${task.processId}</p>
          ${tagsHTML ? `<div class="task-tags">${tagsHTML}</div>` : ''}
          <div class="task-footer">
            <span><i class="far fa-user"></i> ${task.assignee}</span>
            <div class="task-actions">
              <button class="task-btn"><i class="far fa-edit"></i></button>
              <button class="task-btn"><i class="far fa-comment"></i></button>
            </div>
          </div>
          <div style="font-size: 12px; color: var(--text-light); margin-top: 5px;">
            <i class="far fa-calendar-alt"></i> ${task.deadline}
          </div>
        `;
        if (task.status === 'todo') todoColumn.appendChild(taskElement);
        else if (task.status === 'in-progress') inProgressColumn.appendChild(taskElement);
        else if (task.status === 'paused') pausedColumn.appendChild(taskElement);
        else if (task.status === 'completed') completedColumn.appendChild(taskElement);
      });
    }

    // Рендер таблицы эффективности
    function renderEfficiencyTable() {
      const tableBody = document.getElementById('efficiency-table-body');
      tableBody.innerHTML = '';

      const efficiencyData = [
        { name: "Петров А.В.", dept: "УОРиПМ", completion: 92, avgTime: 1.8, returns: 4 },
        { name: "Сидорова Е.П.", dept: "УОРиПМ", completion: 88, avgTime: 2.1, returns: 1 },
        { name: "Иванов И.И.", dept: "УОРиПМ", completion: 78, avgTime: 3.0, returns: 3 },
        { name: "Кузнецова О.Л.", dept: "ЭО", completion: 75, avgTime: 2.5, returns: 2 },
        { name: "Смирнов Д.М.", dept: "ЭО", completion: 72, avgTime: 2.8, returns: 4 }
      ];

      efficiencyData.forEach(emp => {
        const row = document.createElement('tr');
        row.style.borderBottom = '1px solid #eee';
        row.innerHTML = `
          <td style="padding: 12px;">
            <strong>${emp.name}</strong>
          </td>
          <td style="padding: 12px; color: var(--text-light);">${emp.dept}</td>
          <td style="padding: 12px; text-align: center;">
            <span style="color: ${emp.completion >= 80 ? 'var(--success-color)' : emp.completion >= 60 ? 'var(--warning-color)' : 'var(--danger-color)'};">
              ${emp.completion}%
            </span>
          </td>
          <td style="padding: 12px; text-align: center; color: var(--text-light);">${emp.avgTime}</td>
          <td style="padding: 12px; text-align: center; color: ${emp.returns > 3 ? 'var(--danger-color)' : 'var(--text-light)'};">
            ${emp.returns}
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    // Инициализация drag and drop
    function initDragAndDrop() {
      const items = document.querySelectorAll('.kanban-item');
      const columns = document.querySelectorAll('.kanban-column');
      let draggedItem = null;
      items.forEach(item => {
        item.addEventListener('dragstart', () => {
          draggedItem = item;
          setTimeout(() => {
            item.style.opacity = '0.5';
          }, 0);
        });
        item.addEventListener('dragend', () => {
          setTimeout(() => {
            draggedItem.style.opacity = '1';
            draggedItem = null;
          }, 0);
        });
      });
      columns.forEach(column => {
        column.addEventListener('dragover', e => {
          e.preventDefault();
        });
        column.addEventListener('dragenter', e => {
          e.preventDefault();
        });
        column.addEventListener('drop', e => {
          e.preventDefault();
          if (draggedItem) {
            const newStatus = getStatusByColumnId(column.id);
            column.querySelector('.kanban-items').appendChild(draggedItem);
          }
        });
      });
    }

    // Вспомогательные функции
    function getStatusByColumnId(columnId) {
      const map = {
        'todo-column': 'todo',
        'in-progress-column': 'in-progress',
        'paused-column': 'paused',
        'completed-column': 'completed'
      };
      return map[columnId] || 'todo';
    }

    // Подсчёт задач на оценке
    function updateNotificationBadge() {
      const estimationTasks = mockData.tasks.filter(t => 
        t.status === 'estimation' || t.tags.includes('оценка') || t.tags.includes('на оценке')
      ).length;
      const badge = document.getElementById('notification-badge');
      if (estimationTasks > 0) {
        badge.textContent = estimationTasks;
        badge.style.display = 'inline';
      } else {
        badge.style.display = 'none';
      }
    }

    // Обработчики событий
    function setupEventListeners() {
      // Фильтр подразделений
      document.getElementById('department-filter').addEventListener('change', function() {
        const selectedDept = this.value;
        const filteredEmployees = filterEmployeesByDepartment(selectedDept);
        renderWorkload(filteredEmployees);
      });

      // Быстрое создание задачи
      document.querySelector('.btn-primary').addEventListener('click', function() {
        const taskInput = document.querySelector('.form-control');
        if (taskInput.value.trim()) {
          alert(`Задача "${taskInput.value}" создана (имитация)`);
          taskInput.value = '';
          const newTask = {
            id: mockData.tasks.length + 1,
            name: taskInput.value,
            processId: Math.floor(Math.random() * 4) + 1,
            status: 'todo',
            priority: 'medium',
            assignee: 'Иванов И.И.',
            deadline: '20.08.2024',
            tags: ['новая']
          };
          mockData.tasks.push(newTask);
          renderKanbanTasks(mockData.tasks);
        }
      });

      // Фильтры задач
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
        });
      });
    }

    // Инициализация при загрузке страницы
    document.addEventListener('DOMContentLoaded', function() {
      renderWorkload(mockData.employees);
      renderKanbanTasks(mockData.tasks);
      renderEfficiencyTable();
      initDragAndDrop();
      setupEventListeners();
      updateNotificationBadge(); // Обновляем оповещение
    });
  </script>
</body>
</html>