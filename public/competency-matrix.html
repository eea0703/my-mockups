<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Матрица компетенций - Россельхозбанк</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary-color: #0a5f38;  /* тёмно-зелёный */
      --primary-light: #e8f5e9;
      --success-color: #4caf50;  /* зелёный */
      --warning-color: #ff9800;  /* оранжевый */
      --danger-color: #f44336;   /* красный */
      --text-color: #333;
      --text-light: #666;
      --light-gray: #e0e0e0;
      --bg-color: #f5f5f5;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Roboto', sans-serif;
      color: var(--text-color);
      background-color: var(--bg-color);
      line-height: 1.5;
    }
    .container {
      display: grid;
      grid-template-columns: 250px 1fr;
      min-height: 100vh;
    }
    .sidebar {
      background-color: var(--primary-color);
      color: white;
      padding: 20px 0;
    }
    .logo {
      text-align: center;
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .nav-menu {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .nav-item {
      padding: 12px 20px;
      cursor: pointer;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      font-size: 15px;
    }
    .nav-item:hover, .nav-item.active {
      background-color: rgba(255, 255, 255, 0.1);
    }
    .nav-item i {
      margin-right: 12px;
      width: 20px;
      text-align: center;
      font-size: 16px;
    }
    .nav-item a {
      color: inherit;
      text-decoration: none;
      display: flex;
      align-items: center;
      width: 100%;
      height: 100%;
    }
    .main-content {
      padding: 20px;
      background-color: var(--bg-color);
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--light-gray);
    }
    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .card-title {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 15px;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .card-title i {
      margin-right: 10px;
    }
    .btn {
      padding: 8px 12px;
      border-radius: 4px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }
    .btn-warning {
      background-color: var(--warning-color);
      color: white;
    }
    .btn-success {
      background-color: var(--success-color);
      color: white;
    }
    .btn-outline {
      background-color: white;
      border: 1px solid var(--light-gray);
      color: var(--text-color);
    }
    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
    }
    .level {
      display: inline-block;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      color: white;
      font-weight: 500;
      line-height: 28px;
      font-size: 13px;
      cursor: pointer;
    }
    .level-0 { background-color: #ddd; color: #666; }
    .level-1 { background-color: var(--danger-color); }
    .level-2 { background-color: #ff9800; }
    .level-3 { background-color: #8bc34a; }  /* зелёный вместо синего */
    .level-4 { background-color: var(--success-color); }
    .level-5 { background-color: var(--primary-color); }
    .competency-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    .competency-table th {
      text-align: left;
      padding: 12px 10px;
      background-color: #f5f5f5;
      font-weight: 500;
      border-bottom: 2px solid var(--light-gray);
    }
    .competency-table th:first-child {
      min-width: 200px;
    }
    .competency-table td {
      padding: 10px;
      border-bottom: 1px solid var(--light-gray);
      text-align: center;
    }
    .competency-table tr:hover {
      background-color: var(--primary-light);
    }
    .legend {
      display: flex;
      gap: 15px;
      margin: 15px 0;
      font-size: 13px;
      color: var(--text-light);
      flex-wrap: wrap;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: inline-block;
    }
    .legend-0 { background-color: #ddd; }
    .legend-1 { background-color: var(--danger-color); }
    .legend-2 { background-color: #ff9800; }
    .legend-3 { background-color: #8bc34a; }
    .legend-4 { background-color: var(--success-color); }
    .legend-5 { background-color: var(--primary-color); }
    .add-skill-input {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .add-skill-input input {
      flex: 1;
      padding: 8px;
      border: 1px solid var(--light-gray);
      border-radius: 4px;
    }
    .actions-cell {
      display: flex;
      gap: 10px;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 500px;
      max-width: 90%;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      border-bottom: 1px solid var(--light-gray);
      padding-bottom: 10px;
    }
    .close {
      font-size: 24px;
      cursor: pointer;
    }
    .activity-list {
      margin-bottom: 15px;
    }
    .activity-item {
      padding: 8px;
      background: #f9f9f9;
      border-radius: 4px;
      margin-bottom: 6px;
      font-size: 14px;
    }
    .event-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
    }
    .event-card {
      background: white;
      border: 1px solid #eee;
      border-radius: 6px;
      padding: 12px;
      font-size: 14px;
    }
    .event-title {
      font-weight: 500;
      margin-bottom: 4px;
    }
    .event-person {
      color: var(--text-light);
      font-size: 13px;
    }
    .event-date {
      color: var(--primary-color);
      font-weight: 500;
      font-size: 13px;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Сайдбар -->
    <div class="sidebar">
      <div class="logo">
        <h3>Россельхозбанк</h3>
        <p>Управление процессами</p>
      </div>
      <div class="nav-menu">
        <div class="nav-item"><a href="index.html"><i class="fa fa-list"></i> Задачи</a></div>
        <div class="nav-item"><a href="processes.html"><i class="fas fa-project-diagram"></i> Процессы</a></div>
        <div class="nav-item"><a href="projects.html"><i class="fas fa-briefcase"></i> Проекты</a></div>
        <div class="nav-item"><a href="#"><i class="fas fa-tasks"></i> Мои задачи</a></div>
        <div class="nav-item"><a href="#"><i class="fas fa-chart-bar"></i> Аналитика</a></div>
        <div class="nav-item"><a href="#"><i class="fas fa-cog"></i> Настройки</a></div>
        <div class="nav-item"><a href="planner.html"><i class="fas fa-calendar-alt"></i> Планировщик</a></div>
        <div class="nav-item active"><a href="competency-matrix.html"><i class="fas fa-th"></i> Матрица компетенций</a></div>
      </div>
    </div>

    <!-- Основной контент -->
    <div class="main-content">
      <div class="header">
        <h2><i class="fas fa-th"></i> Матрица компетенций сотрудников</h2>
      </div>

      <!-- Легенда -->
      <div class="card">
        <div class="card-title"><i class="fas fa-sitemap"></i> Уровни компетенций</div>
        <div class="legend">
          <div class="legend-item"><span class="legend-color legend-0"></span> 0 — Не владеет</div>
          <div class="legend-item"><span class="legend-color legend-1"></span> 1 — Основы</div>
          <div class="legend-item"><span class="legend-color legend-2"></span> 2 — С поддержкой</div>
          <div class="legend-item"><span class="legend-color legend-3"></span> 3 — Самостоятельно</div>
          <div class="legend-item"><span class="legend-color legend-4"></span> 4 — Эксперт</div>
          <div class="legend-item"><span class="legend-color legend-5"></span> 5 — Лидер / Наставник</div>
        </div>
      </div>

      <!-- УОРиПМ -->
      <div class="card" id="dept-УОРиПМ">
        <div class="card-title">
          <i class="fas fa-building"></i> УОРиПМ
        </div>
        <button class="btn btn-outline" onclick="addSkill('УОРиПМ')">+ Добавить навык</button>
        <div class="table-responsive">
          <table class="competency-table">
            <thead id="thead-УОРиПМ"></thead>
            <tbody id="tbody-УОРиПМ"></tbody>
          </table>
        </div>
      </div>

      <!-- ЭО -->
      <div class="card" id="dept-ЭО">
        <div class="card-title">
          <i class="fas fa-building"></i> ЭО
        </div>
        <button class="btn btn-outline" onclick="addSkill('ЭО')">+ Добавить навык</button>
        <div class="table-responsive">
          <table class="competency-table">
            <thead id="thead-ЭО"></thead>
            <tbody id="tbody-ЭО"></tbody>
          </table>
        </div>
      </div>

      <!-- УПМ -->
      <div class="card" id="dept-УПМ">
        <div class="card-title">
          <i class="fas fa-building"></i> УПМ
        </div>
        <button class="btn btn-outline" onclick="addSkill('УПМ')">+ Добавить навык</button>
        <div class="table-responsive">
          <table class="competency-table">
            <thead id="thead-УПМ"></thead>
            <tbody id="tbody-УПМ"></tbody>
          </table>
        </div>
      </div>

      <!-- Ближайшие события по ИПР -->
      <div class="card">
        <div class="card-title"><i class="fas fa-calendar-check"></i> Ближайшие события по ИПР</div>
        <div class="event-list" id="upcoming-events">
          <!-- Заполняется через JS -->
        </div>
      </div>
    </div>
  </div>

  <!-- Модальное окно: ИПР -->
  <div class="modal" id="ipr-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="ipr-modal-title">ИПР: Иванов И.И.</h3>
        <span class="close" onclick="closeModal('ipr-modal')">&times;</span>
      </div>
      <div>
        <h4>Запланированные активности</h4>
        <div class="activity-list" id="activity-list">
          <!-- Заполняется через JS -->
        </div>
        <div class="add-skill-input">
          <input type="text" id="new-activity" placeholder="Название активности">
          <input type="date" id="activity-date" class="form-control">
          <button class="btn btn-primary" onclick="addActivity()">Добавить</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // === Мок-данные ===
    const competencyData = {
      "УОРиПМ": [
        { name: "Петров А.В.", skills: { "Процессный эксперт": 4, "Нормировщик": 3, "Сопровождение УОБ": 5, "Управление проектами": 4 } },
        { name: "Сидорова Е.П.", skills: { "Процессный эксперт": 5, "Нормировщик": 4, "Сопровождение УОБ": 4, "Управление проектами": 5 } },
        { name: "Иванов И.И.", skills: { "Процессный эксперт": 3, "Нормировщик": 2, "Сопровождение УОБ": 3, "Управление проектами": 3 } }
      ],
      "ЭО": [
        { name: "Кузнецова О.Л.", skills: { "Управление КФК": 5, "Работа с Excel": 5, "Автоматизация": 4 } },
        { name: "Смирнов Д.М.", skills: { "Управление КФК": 3, "Работа с Excel": 3, "Автоматизация": 2 } }
      ],
      "УПМ": [
        { name: "Васильева А.К.", skills: { "Работа с Excel": 5, "Автоматизация": 5, "Коммуникация": 4 } },
        { name: "Николаев П.С.", skills: { "Работа с Excel": 4, "Автоматизация": 1, "Коммуникация": 3 } },
        { name: "Фролова М.А.", skills: { "Работа с Excel": 4, "Автоматизация": 4, "Коммуникация": 5 } }
      ]
    };

    // ИПР данные
    const iprData = {
      "Петров А.В.": [
        { activity: "Обучение по нормированию", date: "2024-08-15", type: "обучение" },
        { activity: "Наставничество по УОБ", date: "2024-08-18", type: "наставничество" }
      ],
      "Сидорова Е.П.": [
        { activity: "Отработка возвратов по согласованиям", date: "2024-08-20", type: "отработка" }
      ],
      "Иванов И.И.": [],
      "Кузнецова О.Л.": [],
      "Смирнов Д.М.": [
        { activity: "Тренинг по Excel", date: "2024-08-16", type: "обучение" }
      ],
      "Васильева А.К.": [],
      "Николаев П.С.": [
        { activity: "Обучение по RPA", date: "2024-08-17", type: "обучение" }
      ],
      "Фролова М.А.": []
    };

    // Рендер матриц
    function renderDepartment(dept) {
      const thead = document.getElementById(`thead-${dept}`);
      const tbody = document.getElementById(`tbody-${dept}`);
      const data = competencyData[dept];

      // Заголовки
      let thHtml = '<tr><th>Сотрудник</th>';
      const skills = Object.keys(data[0].skills);
      skills.forEach(skill => {
        thHtml += `<th>${skill}</th>`;
      });
      thHtml += '<th>Действия</th></tr>';
      thead.innerHTML = thHtml;

      // Строки
      tbody.innerHTML = '';
      data.forEach(emp => {
        const tr = document.createElement('tr');
        let tdHtml = `<td><strong>${emp.name}</strong></td>`;
        skills.forEach(skill => {
          const level = emp.skills[skill];
          tdHtml += `<td><div class="level level-${level}" onclick="editLevel('${dept}', '${emp.name}', '${skill}')">${level}</div></td>`;
        });
        tdHtml += `<td><button class="btn btn-sm btn-primary" onclick="openIprModal('${emp.name}')">ИПР</button></td>`;
        tr.innerHTML = tdHtml;
        tbody.appendChild(tr);
      });
    }

    // Изменение уровня
    function editLevel(dept, name, skill) {
      const emp = competencyData[dept].find(e => e.name === name);
      let level = emp.skills[skill];
      level = (level + 1) % 6; // 0–5
      emp.skills[skill] = level;
      renderDepartment(dept);
    }

    // Добавить навык
    function addSkill(dept) {
      const skillName = prompt(`Введите название нового навыка для ${dept}:`);
      if (!skillName || skillName.trim() === '') return;
      competencyData[dept].forEach(emp => {
        emp.skills[skillName.trim()] = 0;
      });
      renderDepartment(dept);
    }

    // === ИПР ===
    function openIprModal(name) {
      document.getElementById('ipr-modal-title').textContent = `ИПР: ${name}`;
      const list = document.getElementById('activity-list');
      list.innerHTML = '';

      const activities = iprData[name] || [];
      if (activities.length === 0) {
        list.innerHTML = '<div class="activity-item">Нет запланированных активностей</div>';
      } else {
        activities.forEach(act => {
          const item = document.createElement('div');
          item.className = 'activity-item';
          item.textContent = `${act.activity} (${act.type}) — ${formatDate(act.date)}`;
          list.appendChild(item);
        });
      }

      window.currentIprEmployee = name;
      document.getElementById('ipr-modal').style.display = 'flex';
    }

    function addActivity() {
      const input = document.getElementById('new-activity');
      const dateInput = document.getElementById('activity-date');
      const name = window.currentIprEmployee;
      const activity = input.value.trim();
      const date = dateInput.value;

      if (!activity || !date) {
        alert('Заполните название и дату');
        return;
      }

      if (!iprData[name]) iprData[name] = [];
      iprData[name].push({ activity, date, type: "обучение" });
      input.value = '';
      dateInput.value = '';

      // Обновить список
      openIprModal(name);
      // Обновить ближайшие события
      renderUpcomingEvents();
    }

    function closeModal(id) {
      document.getElementById(id).style.display = 'none';
    }

    // === Ближайшие события ===
    function renderUpcomingEvents() {
      const container = document.getElementById('upcoming-events');
      container.innerHTML = '';

      const now = new Date();
      const events = [];

      Object.keys(iprData).forEach(name => {
        iprData[name].forEach(act => {
          const date = new Date(act.date);
          if (date >= now) {
            events.push({ name, ...act });
          }
        });
      });

      // Сортировка по дате
      events.sort((a, b) => new Date(a.date) - new Date(b.date));

      events.slice(0, 6).forEach(event => {
        const card = document.createElement('div');
        card.className = 'event-card';
        card.innerHTML = `
          <div class="event-title">${event.activity}</div>
          <div class="event-person">${event.name}</div>
          <div class="event-date">${formatDate(event.date)}</div>
        `;
        container.appendChild(card);
      });

      if (events.length === 0) {
        container.innerHTML = '<div>Нет запланированных событий</div>';
      }
    }

    function formatDate(dateStr) {
      const [y, m, d] = dateStr.split('-');
      return `${d}.${m}.${y}`;
    }

    // Инициализация
    document.addEventListener('DOMContentLoaded', () => {
      renderDepartment('УОРиПМ');
      renderDepartment('ЭО');
      renderDepartment('УПМ');
      renderUpcomingEvents();
    });
  </script>
</body>
</html>